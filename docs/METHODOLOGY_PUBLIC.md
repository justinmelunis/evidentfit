# How EvidentFit Works

## Our Philosophy: Evidence First, Always

EvidentFit is built on one core principle: **every recommendation must link directly to peer-reviewed research**. We don't cherry-pick studies to support predetermined conclusions. We don't let commission rates influence what we recommend. We start with the evidence and let that guide everything else.

### Why This Matters
The supplement industry is full of marketing hype, proprietary blends, and exaggerated claims. We believe you deserve better: transparent, research-backed guidance you can verify yourself.

### Our Commitment
- **Transparent sourcing**: Every claim links to a specific PubMed study
- **Editorial independence**: Research drives recommendations, not affiliate commissions
- **Safety first**: Drug interactions, contraindications, and safety warnings are built into every recommendation
- **Honest about limitations**: If evidence is weak or missing, we tell you

---

## Part 1: Publication Selection & Curation

### Where Our Research Comes From

**Source**: PubMed / MEDLINE  
The U.S. National Library of Medicine's database of 35+ million peer-reviewed biomedical studies.

**What We Include:**
- ✅ Human studies on resistance training and athletic performance supplements
- ✅ Published, peer-reviewed research from established journals
- ✅ Studies measuring outcomes that matter: strength, muscle mass, performance, recovery, body composition
- ✅ Multiple study types: meta-analyses, RCTs, crossover trials, observational studies

**What We Exclude:**
- ❌ Animal studies (rats, mice, fish, in vitro cell cultures)
- ❌ Industry marketing materials and non-peer-reviewed sources
- ❌ Environmental/pollution research (e.g., nitrogen dioxide air quality studies)
- ❌ Cardiac hypertrophy and other medical conditions unrelated to exercise
- ❌ Studies with severe methodological flaws
- ❌ Non-human populations or irrelevant contexts

**Current Database**: ~30,000 carefully curated research papers, selected from 190,000+ candidate studies via comprehensive multi-supplement search (63 supplements), quality filtering (reliability scoring), and iterative diversity filtering with minimum quotas, updated monthly.

### How We Evaluate Quality

Not all studies are created equal. We assess research using multiple objective criteria:

#### 1. Study Design Quality
We prioritize the strongest types of research:
- **Meta-analyses & systematic reviews**: The gold standard—studies that analyze multiple other studies
- **Randomized controlled trials (RCTs)**: Participants randomly assigned to supplement or placebo groups
- **Crossover studies**: Each participant tries both supplement and placebo
- **Observational studies**: Useful for context but carry less weight

#### 2. Sample Size & Statistical Power
- Larger, well-powered studies carry more weight
- We prioritize double-blind, placebo-controlled designs
- Studies with clear inclusion/exclusion criteria and defined populations

#### 3. Publication Quality
- Journal reputation and peer review rigor
- Author credentials and potential conflicts of interest
- Replication by independent research groups

#### 4. Historical Depth vs. Current Methods
- We evaluate all relevant research from 1990+ to present
- Seminal foundational papers that established evidence bases
- Current studies with refined methodologies
- Comprehensive historical perspective ensures no key findings are missed

### We Only Include Relevant Human Research

We're very selective about what studies make it into our database:

**✅ What We Include:**
- Human studies on exercise and athletic performance
- Research on people who actually train (not just sedentary individuals)
- Studies measuring outcomes that matter: strength, muscle growth, endurance, recovery

**❌ What We Exclude:**
- Animal studies (rats, mice, etc.)
- Test tube research that doesn't translate to real people
- Medical studies unrelated to exercise
- Research on supplements for diseases rather than performance

**The Goal**: Every study in our database is directly relevant to people who exercise and want to improve their performance or physique.

### Complete Supplement Coverage

We track research on **63 different supplements**, including:
- **Popular supplements**: Creatine, protein powder, caffeine, beta-alanine
- **Performance compounds**: HMB, citrulline, betaine, taurine, nitrate
- **Essential nutrients**: Vitamin D, magnesium, omega-3, iron, B12
- **Emerging supplements**: Ashwagandha, rhodiola, cordyceps, alpha-GPC, theacrine
- **Specialized compounds**: Collagen, resveratrol, NAC, CoQ10, phosphatidylserine
- **Alternative forms**: Multiple creatine forms, protein sources, omega-3 types

We use both common names and scientific terminology to ensure comprehensive research coverage.

### How We Build Our Research Database

We don't just grab random studies—we systematically search and evaluate research to build the most comprehensive supplement database possible:

```
┌────────────────────────────────────────────────────────────┐
│              HOW WE FIND THE BEST RESEARCH                 │
└────────────────────────────────────────────────────────────┘

  PubMed Database (35+ million studies)
       ↓
  Multi-Supplement Search (63 supplements)
  (Individual queries per supplement, 1990 → present)
  (Date-based chunking to bypass PubMed's 10K limit)
       ↓
┌─────────────────────┐
│ Step 1: Fetch &     │ → Search each supplement individually (63 queries)
│ Parse               │ → Fetch ~190,000 PMIDs from PubMed
│                     │ → Parse XML metadata and abstracts
│                     │ → Filter out animal/in-vitro studies during parsing
│                     │ → Extract supplements, outcomes, study type
└─────────────────────┘
       ↓
  ~125,000 Human Studies Parsed
  (~65,000 filtered: animal studies, missing abstracts, parsing errors)
       ↓
┌─────────────────────┐
│ Step 2: Quality     │ → Reliability scoring (study type, sample size, journal)
│ Filter              │ → Meta-analyses score highest (13+ points)
│                     │ → RCTs and systematic reviews prioritized (10-12 points)
│                     │ → Quality threshold: 2.0+ (removes ~55,000 low-quality)
└─────────────────────┘
       ↓
  ~69,000 Quality Studies
       ↓
┌─────────────────────┐
│ Step 3: Minimum     │ → Protect 3+ papers per supplement (192 protected)
│ Quota Protection    │ → Ensure rare supplements aren't eliminated
│                     │ → Sorted by quality within each supplement
│                     │ → Protected IDs exempt from diversity filtering
└─────────────────────┘
       ↓
┌─────────────────────┐
│ Step 4: Iterative   │ → Progressive elimination in rounds
│ Diversity Filtering │ → Recalculate weights each round
│                     │ → Balance supplement-goal-population combinations
│                     │ → Ensure diverse, representative coverage
└─────────────────────┘
       ↓
         Final Database: ~30,000 Best Studies
         (The research that powers your recommendations)
```

**The Result**: We evaluate ~190,000 PMIDs, parse ~125,000 papers, and select the best ~30,000 for our database. This ensures you get recommendations based on the highest quality research while maintaining balanced coverage across all 63 supplements—not just the most popular ones.

### Why Our Approach Is Different

Most supplement sites cherry-pick studies that support what they want to sell. We do the opposite:

**🎯 We Start With ALL The Research**
Instead of searching for "studies that show X works," we search for "all studies about X" and let the evidence speak for itself. We run 63 separate PubMed queries—one for each supplement—to ensure comprehensive coverage.

**⚖️ We Balance Quality With Coverage**
Popular supplements like creatine have 20,000+ studies. Emerging supplements might have hundreds. A simple "take the best studies" approach would give you a database that's 90% creatine research.

Our **minimum quota system** protects at least 3 papers per supplement, ensuring even rare supplements get representation. Then our **iterative diversity filtering** progressively refines the selection to balance coverage while prioritizing quality.

**🔄 We Continuously Refine**
Our diversity filtering works in rounds, recalculating balance weights after each elimination. This progressive refinement means high-quality research on lesser-known supplements doesn't get buried by the sheer volume of creatine studies.

**🛡️ Protected Quality Standards**
While we ensure coverage, we never sacrifice quality:
- All papers must pass a reliability threshold (2.0+)
- Protected papers are still the highest-quality for their supplement
- Meta-analyses and RCTs are prioritized within quotas
- Low-evidence supplements are flagged transparently (Grade C/D)

**The Bottom Line**: You get recommendations based on the best available research for each supplement, not just the supplements with the most research.

---

## Part 2: Research Chat Agent

### How the Chat Agent Works

When you ask a question about supplements, here's what happens:

```
┌─────────────────────────────────────────────────────────────────┐
│                    RESEARCH CHAT FLOW                            │
└─────────────────────────────────────────────────────────────────┘

  Your Question
       ↓
  "What does research say about creatine for strength?"
       ↓
┌─────────────────────┐
│  STEP 1: Search     │  → Semantic search across 10,000+ papers
│  Retrieve Papers    │  → Returns top 10-15 most relevant studies
└─────────────────────┘
       ↓
  [Paper 1: "Creatine supplementation and resistance training..."]
  [Paper 2: "Effects of creatine on strength in trained athletes..."]
  [Paper 3: "Meta-analysis of creatine monohydrate efficacy..."]
       ↓
┌─────────────────────┐
│  STEP 2: Synthesize │  → AI reads retrieved papers only
│  Evidence (AI)      │  → Cannot cite papers it didn't retrieve
└─────────────────────┘
       ↓
┌─────────────────────┐
│  STEP 3: Response   │  → Clear answer with evidence grades
│  with Citations     │  → Direct PubMed links for every claim
└─────────────────────┘
       ↓
  Your Answer + Citations
```

#### What Happens at Each Step

**Step 1: Semantic Search**
Your question is converted into a mathematical representation (embedding) and matched against our 10,000+ paper database. We retrieve the 10-15 most relevant studies for your specific question.

**Step 2: Evidence Synthesis**
An AI model (GPT-4o-mini via Azure AI Foundry) reads the retrieved papers and synthesizes findings into a clear, accurate answer. The AI is strictly limited to citing papers it actually retrieved—it cannot invent citations.

**Step 3: Citation & Transparency**
Every claim in the response links to specific studies. You get:
- Study title and authors
- Journal and publication year
- Study design (meta-analysis, RCT, etc.)
- Direct PubMed link to verify the research yourself

### What the Chat Agent Can Do
- Answer specific questions about individual supplements
- Explain mechanisms of action based on research
- Compare supplements for specific goals
- Identify potential side effects and contraindications mentioned in research
- Point you to the strongest evidence for or against a supplement

### What It Cannot Do
- ❌ Provide medical advice or diagnose conditions
- ❌ Recommend dosing without you using the Stack Planner
- ❌ Cite research it hasn't retrieved (no hallucinations)
- ❌ Make claims beyond what the research supports

---

## Part 3: Personalized Stack Generation

The Stack Planner builds a complete, personalized supplement protocol tailored to your unique profile using our **three-level evidence banking system**.

### How Stack Generation Works

```
┌─────────────────────────────────────────────────────────────────┐
│                PERSONALIZED STACK GENERATION                     │
└─────────────────────────────────────────────────────────────────┘

  Your Profile + Context
       ↓
  Goal: Muscle growth | Weight: 176 lbs | Age: 28 | Sex: Female
  Context: "I'm vegan and train 5x/week. Interested in creatine."
       ↓
┌──────────────────────────────────────────────────────────────────┐
│  PHASE 1: Three-Level Evidence Banking                          │
│                                                                  │
│  Level 1: Goal × Supplement Evidence (Always cached)           │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │ "creatine +     │ ──→│ LLM Research    │ ──→ Grade A        │
│  │  hypertrophy"   │    │ Agent Analysis  │    (67 studies)    │
│  │                 │    │ (reads papers)  │                    │
│  └─────────────────┘    └─────────────────┘                    │
│                                                                  │
│  Level 2: Profile-Specific Reasoning (Banking Check)           │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │ Generate Key    │ ──→│ Check Cache     │                    │
│  │ "hypertrophy:   │    │ 360 pre-computed│                    │
│  │  medium:female: │    │ combinations    │                    │
│  │  young"         │    │                 │                    │
│  └─────────────────┘    └─────────────────┘                    │
└──────────────────────────────────────────────────────────────────┘
       ↓ (if cached)         ↓ (if not cached)
       │               ┌──────────────────────────────────────────┐
       │               │  LLM Profile Analysis (Generate)         │
       │               │  ┌────────────┐    ┌─────────────┐      │
       │               │  │  AI Model  │ ──→│ Personalized│      │
       │               │  │  + Papers  │    │ Reasoning   │      │
       │               │  └────────────┘    └─────────────┘      │
       │               │  "For your profile (28yo female),       │
       │               │  creatine enhances training capacity    │
       │               │  because studies in female athletes..." │
       │               │  💾 Save to Level 2 cache               │
       │               └──────────────────────────────────────────┘
       │                        ↓
       └────────────────────────┘
                ↓
┌──────────────────────────────────────────────────────────────────┐
│  Level 3: Real-Time Context Analysis (Never cached)             │
│  ┌─────────────────┐    ┌─────────────────┐                    │
│  │ Parse Chat:     │ ──→│ Apply Rules:    │                    │
│  │ "I have anxiety"│    │ Block caffeine  │                    │
│  │ "I'm vegan"     │    │ Add B12, Iron   │                    │
│  │ "Interested in  │    │ Include creatine│                    │
│  │  creatine"      │    │ with details    │                    │
│  └─────────────────┘    └─────────────────┘                    │
│                                                                  │
│  Real-Time Personalization Process:                             │
│  • Extract conditions: "I have anxiety" → block caffeine       │
│  • Extract medications: "I take SSRIs" → interaction check     │
│  • Extract preferences: "I'm interested in creatine" → include │
│  • Apply safety rules: pregnancy, age, sensitivities          │
└──────────────────────────────────────────────────────────────────┘
       ↓
┌──────────────────────────────────────────────────────────────────┐
│  PHASE 2: Safety Guardrails (Deterministic Rules)              │
│  Hard Blocks:    Age (<18) | Pregnancy | Meds | Conditions     │
│  Dose Caps:      Based on weight, age, pregnancy, conditions   │
│  Interactions:   FDA drug label screening                       │
│  Result: Safe, appropriate recommendations only                 │
└──────────────────────────────────────────────────────────────────┘
       ↓
┌──────────────────────────────────────────────────────────────────┐
│  PHASE 3: Weight-Adjusted Dosing (No AI Math)                   │
│  Evidence-based formulas by weight bin:                        │
│  • Weight bin: "medium" (70-85kg) for 176 lbs                 │
│  • Creatine: 5g CME/day (standard dose for medium weight)     │
│  • Protein: Gap analysis (target 1.8g/kg - current intake)    │
│  • B12: 2.4 mcg/day (RDA, higher for vegans)                 │
│  • Iron: 18 mg/day (female RDA)                               │
│  • Beta-alanine: 6.4g/day split doses (medium weight)         │
└──────────────────────────────────────────────────────────────────┘
       ↓
┌──────────────────────────────────────────────────────────────────┐
│  PHASE 4: Interactive UI Presentation                           │
│                                                                  │
│  🎯 Your Custom Stack (3 supplements)                          │
│  [Creatine A] [Protein A] [B12 A] ← Interactive summary        │
│                                                                  │
│  Toggle Navigation:                                             │
│  [✅ Recommended (3)] [💡 Optional (2)] [🚫 Not Recommended (1)]│
│                                                                  │
│  Active Section: ✅ RECOMMENDED                                 │
│  ☑ Creatine (Grade A)     📚 Research-backed reasoning         │
│    Why: For your profile (28yo female), creatine enhances      │
│    training capacity because studies show...                   │
│    Dose: 5g/day • Post-workout                                 │
│    Research: [3 PubMed citations with direct links]            │
│                                                                  │
│  ☑ Protein (Grade A)      📊 Gap analysis: 25g supplemental    │
│  ☑ B12 (Grade A)          🌱 Vegan-specific recommendation     │
│                                                                  │
│  💡 Checkbox system allows custom stack building               │
│  🔄 Toggle between sections for full transparency              │
└──────────────────────────────────────────────────────────────────┘
       ↓
  Your Evidence-Based, Personalized Stack
```

### Detailed Phase Breakdown

#### Phase 1: Three-Level Evidence Banking

**Why Three Levels?**
Our banking system operates at three distinct levels to balance performance, personalization, and accuracy:

**Level 1: Goal × Supplement Evidence (378 combinations)**
- Pre-computed evidence grades for every supplement × goal combination (6 goals × 63 supplements)
- **LLM Research Agent**: Reads and analyzes research papers to assign evidence grades (A/B/C/D)
- Grades based on research outcomes (positive/negative/mixed results), not just paper count
- **Supporting Publications**: Each evidence grade includes top 3 supporting research papers with full metadata
- Updated monthly when new research is ingested
- Example: "Creatine + strength = Grade A (LLM analyzed 67 studies showing consistent 5-15% strength gains) + 3 key publications"

**Level 2: Profile-Specific Reasoning (360 combinations)**
- Personalized "why" explanations based on demographics
- Generated by LLM analysis of research papers tailored to user profile
- **Profile-Specific Publications**: Each reasoning includes supporting research papers relevant to the user's demographic profile
- Your profile maps to one of 360 pre-computed combinations:
  - **6 Goals**: Strength, muscle growth, endurance, weight loss, performance, general health
  - **5 Weight Bins**: XS (<60kg), Small (60-70kg), Medium (70-85kg), Large (85-100kg), XL (100kg+)
  - **3 Sex Categories**: Male, female, other/unspecified  
  - **4 Age Bins**: Minor (13-17), young (18-29), adult (30-49), mature (50+)

**Level 3: Real-Time Context Analysis (Never cached)**
- Dynamic modifications based on conversation context
- Text parsing for conditions, medications, specific interests
- **User-Specific Publications**: Real-time research papers relevant to user's specific context and conditions
- Applied in real-time for maximum personalization

**Banking Key Example:**
- 28-year-old, 176 lb (80kg) female, muscle growth goal
- **Key**: `"hypertrophy:medium:female:young"`
- **Result**: Pre-computed base recommendations with evidence grades

**Cache Hit vs. Miss:**
- **Cache Hit** (99% of cases): Instant base recommendations + real-time personalization
- **Cache Miss** (rare profiles): Full AI analysis + evidence validation + save to cache

#### Phase 1B: AI Profile Analysis (For Cache Misses or New Profiles)
When a profile combination hasn't been pre-computed, an AI model analyzes your complete profile to suggest relevant supplements:

**Profile Inputs:**
- Primary goal (strength, muscle growth, endurance, weight loss, performance, general health)
- Weight (for dosing calculations)
- Age (affects metabolism, recovery needs, and appropriate supplements)
- Sex (influences nutrient needs and evidence applicability)
- Dietary preferences (vegan, vegetarian, omnivore)
- Training frequency
- Caffeine sensitivity
- Pregnancy/breastfeeding status
- Medical conditions
- Current medications

**User Context Analysis:**
The AI reads your free-text input to understand:
- Specific supplements you're interested in or concerned about
- Training schedule and lifestyle factors
- Special considerations ("I train fasted," "I have joint pain," etc.)
- Questions about alternative forms or brands

**AI Suggestion Process:**
The AI considers your demographics and context to suggest supplements proven effective for people like you:
- Example: 55-year-old → HMB for muscle preservation
- Example: Vegan female athlete → B12, iron, algae-based omega-3
- Example: "I'm stressed" → Ashwagandha if evidence supports it for your goals

#### Phase 2: Safety Guardrails (Deterministic Rules)
Every supplement goes through strict safety checks:

**Hard Blocks:**
- Age restrictions (e.g., no stimulants for minors)
- Pregnancy/breastfeeding contraindications  
- Medical condition conflicts (e.g., no caffeine with anxiety disorders)
- Medication interactions (e.g., no stimulants with MAOIs)

**Dose Adjustments:**
- Caffeine sensitivity → Lower dose range
- Pregnancy → FDA/ACOG recommended limits
- Older adults → Age-adjusted dosing
- Medical conditions → Conservative caps

**Interaction Screening:**
Using FDA drug label data, we check for potential supplement-medication interactions and surface warnings.

#### Phase 3: Weight-Adjusted Dosing (No AI Math)
Dosing is **never done by the AI**—it uses evidence-based formulas tailored to your weight bin:

**Weight Bin System:**
Your weight determines dosing ranges proven effective in research:
- **XS (<60kg)**: Lower doses, conservative approach
- **Small (60-70kg)**: Standard doses with some adjustments  
- **Medium (70-85kg)**: Standard research-based doses (most studies)
- **Large (85-100kg)**: Higher doses for weight-dependent supplements
- **XL (100kg+)**: Maximum effective doses, loading phases where beneficial

**Supplement-Specific Dosing:**

**Creatine Monohydrate Equivalent (CME):**
- XS/Small: 3g CME/day | Medium: 5g CME/day | Large/XL: 5-7g CME/day
- All dosing anchored to monohydrate equivalents (the form with the most research)
- Conversion formulas for alternative forms (anhydrous, HCl)

**Protein Gap Analysis:**
- Calculate target: 1.6-2.2g/kg based on goal and weight
- Compare to your reported dietary intake
- Recommend supplemental protein only if gap ≥ 20g/day
- "Diet-first" philosophy: food sources prioritized

**Other Weight-Adjusted Supplements:**
- **Caffeine**: 3-6 mg/kg (capped by sensitivity and conditions)
- **Beta-alanine**: 3.2g (small) to 6.4g (large) split into multiple doses
- **Citrulline**: 6g (small) to 8g (large) pre-workout
- **HMB**: 3g daily (all weights) with meals

#### Phase 4: Presentation
Your final stack includes:

**✅ Recommended Supplements:**
- Strong evidence for your goals
- Safe based on your profile
- Clear explanation of why it's recommended
- Precise dosing with timing
- **Base Evidence Publications**: 1-3 supporting research citations for the general evidence grade
- **Profile-Specific Publications**: 1-3 additional research citations relevant to your demographic profile

**💡 Optional Supplements (Maybe):**
- Potential additional benefits but not essential
- You decide if worth adding based on evidence
- Full transparency on strength of evidence
- **Complete Publication Trail**: Both base evidence and profile-specific research citations

**🚫 Not Recommended:**
- Supplements excluded due to safety concerns
- Supplements with insufficient evidence for your goals
- Clear explanations of why (e.g., "Caffeine excluded due to anxiety diagnosis")
- **Safety Documentation**: Research citations supporting exclusion decisions

---

## System Architecture: How Our Agents Work Together

Our platform operates through four specialized AI agents that work in concert to deliver evidence-based supplement recommendations:

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           EVIDENTFIT AGENT ECOSYSTEM                            │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  AGENT A: Research Ingestion & Indexing (Monthly Job)                          │
│                                                                                 │
│  PubMed Database                 Enhanced Processing                            │
│  ┌─────────────────┐            ┌─────────────────┐                            │
│  │ 50,000+         │ ──────────→│ • Relevance     │ ──┐                        │
│  │ Candidate       │  Search    │   Filtering     │   │                        │
│  │ Papers          │  Query     │ • Quality       │   │                        │
│  └─────────────────┘            │   Scoring       │   │                        │
│                                 │ • Supplement    │   │                        │
│                                 │   Tagging       │   │                        │
│                                 └─────────────────┘   │                        │
│                                                       ▼                        │
│                                 Azure AI Search Index                          │
│                                 ┌─────────────────┐                            │
│                                 │ ~12,000 Papers  │                            │
│                                 │ • Embeddings    │                            │
│                                 │ • Metadata      │                            │
│                                 │ • Citations     │                            │
│                                 └─────────────────┘                            │
└─────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│  AGENT C: Evidence Summarization (Monthly Job)                                 │
│                                                                                 │
│  Research Analysis              Summary Generation                              │
│  ┌─────────────────┐            ┌─────────────────┐                            │
│  │ Read Papers     │ ──────────→│ • Overview      │                            │
│  │ by Supplement   │  LLM       │ • Historical Trends │                            │
│  │ • Rank Quality  │  Analysis  │ • Key Studies   │                            │
│  │ • Extract Key   │            │ • Evidence      │                            │
│  │   Findings      │            │   Grade         │                            │
│  └─────────────────┘            └─────────────────┘                            │
│                                                                                 │
│                                 Public Summaries                               │
│                                 ┌─────────────────┐                            │
│                                 │ 27 Supplements  │                            │
│                                 │ • Methodology   │                            │
│                                 │ • Evidence      │                            │
│                                 │ • Citations     │                            │
│                                 └─────────────────┘                            │
└─────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│  AGENT E: Banking Initialization (As Needed)                                   │
│                                                                                 │
│  Level 1 Banking                Level 2 Banking                               │
│  ┌─────────────────┐            ┌─────────────────┐                            │
│  │ LLM Research    │            │ LLM Profile     │                            │
│  │ Agent Reads     │            │ Analysis        │                            │
│  │ Papers for Each │            │ • Demographics  │                            │
│  │ Goal×Supplement │            │ • Personalized  │                            │
│  │ Combination     │            │   Reasoning     │                            │
│  └─────────────────┘            └─────────────────┘                            │
│           │                              │                                     │
│           ▼                              ▼                                     │
│  ┌─────────────────┐            ┌─────────────────┐                            │
│  │ 162 Evidence    │            │ 360 Profile     │                            │
│  │ Grades Cached   │            │ Explanations    │                            │
│  │ (A/B/C/D)       │            │ Cached          │                            │
│  └─────────────────┘            └─────────────────┘                            │
└─────────────────────────────────────────────────────────────────────────────────┘
                                         │
                                         ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│  AGENT B: Real-Time User API (Always Running)                                  │
│                                                                                 │
│  User Request                   Intelligence Layer                             │
│  ┌─────────────────┐            ┌─────────────────┐                            │
│  │ Profile +       │ ──────────→│ • Search Papers │                            │
│  │ Question        │  Process   │ • Load Banking  │                            │
│  │ "Best creatine  │            │ • Apply Safety  │                            │
│  │ for strength?"  │            │ • Form Selection│                            │
│  └─────────────────┘            └─────────────────┘                            │
│                                          │                                     │
│                                          ▼                                     │
│  Personalized Response          Stack Generation                               │
│  ┌─────────────────┐            ┌─────────────────┐                            │
│  │ • Evidence      │ ←──────────│ • Recommended   │                            │
│  │ • Dosing        │  Compose   │ • Optional      │                            │
│  │ • Citations     │            │ • Not Recommended│                           │
│  │ • Form Options  │            │ • Form Selection│                            │
│  │ • Safety Notes  │            │ • Custom Stack  │                            │
│  └─────────────────┘            └─────────────────┘                            │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  DATA FLOW SUMMARY                                                             │
│                                                                                 │
│  Monthly: Agent A → New Papers → Agent C → Updated Summaries                   │
│  As Needed: Agent E → GPU-Accelerated Banking Cache Updates (Mistral 7B)      │
│  Real-Time: User → Agent B → Cached Banking + Live Search → Response          │
│                                                                                 │
│  🎯 Result: Fast, personalized, evidence-based supplement recommendations      │
│      with $0 processing costs (local GPU vs $6,750 cloud)                     │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### Agent Responsibilities

**🔍 Agent A (Research Ingestion)**
- **Purpose**: Keep our research database current and comprehensive
- **Frequency**: Monthly automated runs
- **Process**: 
  - **Stage 1 (get_papers)**: 
    - Multi-supplement PubMed search (63 supplements)
    - Enhanced quota system: 10 best overall + 2 per goal combination per supplement
    - Parse XML and fetch full-text from PMC + Unpaywall (85-90% coverage)
    - Quality filtering (2.0+ threshold, never compromised for availability)
    - Full-text preference as tiebreaker (0.8 threshold in diversity rounds)
    - Iterative diversity filtering with full-text-aware selection
    - Centralized sharded storage for full texts
    - Abstract fallback for remaining 10-15% of papers
  - **Stage 2 (paper_processor)**: 
    - GPU-accelerated LLM analysis (Mistral-7B)
    - Smart chunking for long papers (respects context limits)
    - Two-pass extraction (initial + repair prompts)
    - Structured Q&A summaries generation
    - Streaming architecture (processes 30K+ papers)
  - **Stage 3 (indexing)**: Generate embeddings → Upload to Azure AI Search → Update watermark
- **Output**: ~30,000 high-quality, diverse research papers with structured summaries and full-text content
- **Quality Threshold**: 2.0+ reliability score (meta-analyses, RCTs, systematic reviews prioritized)
- **Enhanced Quotas**: 10 best overall + 2 per goal per supplement (~715 protected with overlaps)
- **Full-Text Strategy**: PMC + Unpaywall with 0.8 tiebreak threshold (quality never compromised)
- **Full-Text Coverage**: 85-90% (25-27k papers) via PMC (~73%) + Unpaywall rescue (~12-17%); abstracts for remaining 10-15%

**📊 Agent C (Evidence Summarization)**  
- **Purpose**: Create public-facing supplement summaries
- **Frequency**: Monthly after Agent A completes
- **Process**: Analyze papers by supplement → Rank by quality → Generate summaries
- **Output**: 27 supplement summaries with evidence grades and key studies

**🏦 Agent E (Banking Initialization)**
- **Purpose**: Pre-compute evidence grades and personalized reasoning
- **Frequency**: When evidence base changes or new profiles needed
- **Process**: GPU-accelerated Mistral 7B reads papers → Generates structured summaries → Assigns grades → Generates profile-specific explanations
- **Output**: 162 evidence grades + 360 personalized reasoning sets
- **Cost**: $0 (local GPU processing vs $6,750 cloud processing)

**💬 Agent B (User API)**
- **Purpose**: Deliver real-time personalized recommendations
- **Frequency**: Always running, responds to user requests
- **Process**: Search papers → Load banking → Apply safety → Generate stack
- **Output**: Personalized supplement recommendations with evidence and dosing

---

## Banking System: Speed Meets Personalization

### How We Balance Speed and Customization

**The Challenge**: Providing both fast responses and deeply personalized recommendations.

**Our Solution**: A **three-level evidence banking system** that pre-computes evidence at different granularities while allowing real-time personalization.

### GPU-Accelerated LLM Research Agent Methodology

**How Our AI Evaluates Evidence:**

Our GPU-accelerated LLM Research Agent (Mistral 7B Instruct) doesn't just count papers—it **reads and analyzes** research content to make evidence-based determinations using local processing:

**🚀 GPU-Accelerated Processing:**
- **Local Processing**: Runs on your RTX 3080 GPU, avoiding cloud costs
- **4-bit Quantization**: Optimized for 10GB VRAM with 6-8GB usage
- **Structured Analysis**: Generates detailed summaries with key findings, methodology, and evidence grades
- **Batch Processing**: Efficient processing of 100k+ papers in 3-6 hours

**📚 Enhanced Paper Analysis Process:**
1. **Retrieval**: Fetch top relevant studies for each supplement × goal combination
2. **Structured Analysis**: Mistral 7B reads study abstracts and generates structured summaries with:
   - Key findings and results
   - Methodology and study design
   - Population and demographics
   - Intervention details
   - Outcomes and effect sizes
   - Limitations and clinical significance
   - Evidence quality assessment
3. **Quality Assessment**: Evaluates study design (meta-analysis > RCT > crossover > observational)
4. **Outcome Analysis**: Determines if results are positive, negative, or mixed for the specific goal
5. **Consistency Check**: Looks for agreement across multiple studies
6. **Effect Size Evaluation**: Considers clinical significance, not just statistical significance

**🎯 Evidence Grading Criteria:**
- **Grade A**: Multiple high-quality studies showing consistent, clinically meaningful benefits
- **Grade B**: Some quality studies with generally positive effects, minor inconsistencies
- **Grade C**: Limited studies with mixed results or small effect sizes
- **Grade D**: Insufficient evidence or studies consistently showing no benefit

**🔬 Example Analysis:**
*"Creatine for Strength": Mistral 7B reads 67 studies → generates structured summaries → finds multiple meta-analyses showing 5-15% strength gains → consistent across RCTs → clinically meaningful effects → assigns Grade A*

**💰 Cost Benefits:**
- **Local Processing**: $0 (vs $6,750 for GPT-4o cloud processing)
- **No Rate Limits**: Process unlimited papers without API restrictions
- **Complete Control**: Full control over processing pipeline and data

### Three-Level Architecture

#### **Level 1: Goal × Supplement Evidence Banking**
- **What**: Evidence grades (A/B/C/D) for each supplement × goal combination
- **Cached**: 162 combinations (6 goals × 27 supplements)
- **Source**: **GPU-Accelerated LLM Research Agent** (Mistral 7B) reads and analyzes research papers for goal-specific outcomes
- **Methodology**: AI evaluates study quality, consistency, effect sizes, and relevance to assign grades using structured summaries
- **Supporting Publications**: Each evidence grade includes top 3 supporting research papers with full metadata
- **Updated**: Monthly when new research is ingested
- **Example**: "Creatine for strength = Grade A (Mistral 7B analyzed 67 studies, generated structured summaries, found consistent 5-15% strength gains across multiple meta-analyses) + 3 key publications"

#### **Level 2: Profile-Specific Reasoning Banking**
- **What**: Personalized "why" explanations based on demographics and research
- **Cached**: 360 profile combinations (goal × weight bin × sex × age bin)
- **Source**: **GPU-Accelerated LLM Research Agent** (Mistral 7B) analyzes retrieved papers and generates profile-specific reasoning
- **Methodology**: AI reads research papers and creates personalized explanations based on user demographics using structured summaries
- **Profile-Specific Publications**: Each reasoning includes supporting research papers relevant to the user's demographic profile
- **Updated**: When evidence base changes or new profiles are encountered
- **Example**: "For your profile (28yo male, strength), creatine enhances power output because studies in male athletes show 5g/day increases 1RM by 8-15% (Mistral 7B analyzed 12 relevant studies in this demographic) + 3 demographic-specific publications"

#### **Level 3: Real-Time Adjustments**
- **What**: Dynamic modifications based on conversation context
- **Cached**: Never (always real-time)
- **Source**: Text parsing + safety guardrails + user preferences
- **User-Specific Publications**: Real-time research papers relevant to user's specific context and conditions
- **Applied**: Conditions, medications, specific supplement interests
- **Example**: "Caffeine excluded due to anxiety condition mentioned in chat + supporting research on caffeine and anxiety"

### Technical Implementation

**360 Pre-Computed Profiles:**
- Every combination of goal × weight bin × sex × age bin
- Each profile contains base supplement recommendations with evidence grades
- Updated monthly as new research is published
- Stored for instant retrieval (< 100ms response time)

**Real-Time Layer:**
- Your conversational input adds personalization on top of the base profile
- Medical conditions, medications, and preferences modify recommendations
- Safety guardrails applied to all adjustments
- Final dosing calculated using your exact weight

**Storage Efficiency:**
- 360 profiles × ~6KB each = ~2.2MB total storage
- Fits easily within our infrastructure limits
- Allows for comprehensive coverage without performance impact

### Benefits for You

**⚡ Speed**: Recommendations in seconds, not minutes  
**🎯 Consistency**: Same profile always gets same evidence-based foundation  
**🔒 Safety**: All cached recommendations go through the same safety validation  
**📊 Quality**: More time to validate evidence means higher-quality base recommendations  
**🎨 Personalization**: Your unique context still shapes the final recommendations  

### What Gets Banked vs. What's Real-Time

**Banked (Pre-Computed):**
- Base supplement candidates for your demographic
- Evidence grades based on research for your goal
- **Base Evidence Publications**: Supporting research papers for each evidence grade
- **Profile-Specific Publications**: Research papers relevant to your demographic profile
- Standard dosing ranges for your weight category
- Core safety contraindications

**Real-Time (Personalized):**
- Medical conditions and medication interactions
- Specific supplement requests from your conversation
- Dose adjustments for sensitivities
- **User-Specific Publications**: Research papers relevant to your specific context and conditions
- Explanations tailored to your context
- Final safety screening with your exact profile

---

## Part 4: Independent Supplement Research Database

For users who want to research supplements independently before using the Stack Planner, we provide a comprehensive supplement database at `/supplements` that exposes our Level 1 banking data.

### How the Supplement Database Works

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        SUPPLEMENT DATABASE ARCHITECTURE                         │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  LEVEL 1 BANKING DATA (Source)                                                 │
│                                                                                 │
│  Evidence Banking Cache                Research Paper Analysis                  │
│  ┌─────────────────┐                  ┌─────────────────┐                      │
│  │ 162 Combinations│ ←──────────────── │ LLM Research    │                      │
│  │ • 6 Goals       │  Pre-computed    │ Agent Reads     │                      │
│  │ • 27 Supplements│  Evidence        │ Papers for Each │                      │
│  │ • A/B/C/D Grades│  Grades          │ Goal×Supplement │                      │
│  │ • Paper Counts  │                  │ Combination     │                      │
│  └─────────────────┘                  └─────────────────┘                      │
└─────────────────────────────────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│  API ENDPOINT: GET /supplements/evidence                                        │
│                                                                                 │
│  Data Transformation            Public API Response                             │
│  ┌─────────────────┐            ┌─────────────────┐                            │
│  │ Load Banking    │ ──────────→│ JSON Structure: │                            │
│  │ Files:          │  Format    │ • Goals list    │                            │
│  │ • level1_*.json │  for Web   │ • Supplements   │                            │
│  │ • Supplement    │            │ • Evidence grid │                            │
│  │   metadata      │            │ • Paper counts  │                            │
│  └─────────────────┘            └─────────────────┘                            │
└─────────────────────────────────────────────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│  FRONTEND: /supplements PAGE                                                   │
│                                                                                 │
│  Interactive Interface          Goal-Based Filtering                           │
│  ┌─────────────────┐            ┌─────────────────┐                            │
│  │ • Search bar    │            │ • Goal selector │                            │
│  │ • Supplement    │ ←──────────│ • Evidence      │                            │
│  │   cards         │  Filter    │   highlighting  │                            │
│  │ • Evidence      │  Results   │ • Grade colors  │                            │
│  │   grades        │            │ • Paper counts  │                            │
│  └─────────────────┘            └─────────────────┘                            │
│                                                                                 │
│  User Experience Flow:                                                         │
│  1. Select goal (strength, hypertrophy, endurance, etc.)                      │
│  2. Browse supplements with evidence grades for that goal                      │
│  3. Click supplement for detailed mechanism and research                       │
│  4. See transparent paper counts and evidence reasoning                        │
│  5. Optional: Use findings to inform Stack Planner decisions                   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│  EXAMPLE USER JOURNEY                                                          │
│                                                                                 │
│  User Goal: "I want to research creatine for strength training"               │
│       ↓                                                                        │
│  1. Visit /supplements → Select "Strength" goal                               │
│       ↓                                                                        │
│  2. See: Creatine (Grade A, 67 studies), Caffeine (Grade A, 45 studies)      │
│       ↓                                                                        │
│  3. Click "Creatine" → Detailed page with:                                    │
│     • Mechanism: "Increases phosphocreatine stores..."                        │
│     • Evidence: "Grade A for strength (5-15% improvements)"                   │
│     • Research: Links to key meta-analyses and RCTs                           │
│     • Safety: Contraindications and dosing considerations                     │
│       ↓                                                                        │
│  4. Armed with knowledge → Use Stack Planner for personalized dosing          │
│                                                                                │
│  🎯 Result: Informed user makes evidence-based supplement decisions           │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### Database Features & Functionality

#### **Goal-Specific Evidence Display**
- **Dynamic Filtering**: Select your primary goal (strength, hypertrophy, endurance, weight loss, performance, general health)
- **Evidence Grades**: See how each supplement's evidence changes based on your goal
- **Visual Hierarchy**: A-grade supplements highlighted, D-grade supplements clearly marked
- **Paper Transparency**: Exact number of studies analyzed for each grade

#### **Supplement Detail Pages**
Each supplement includes comprehensive information:

**📋 Mechanism of Action**
- How the supplement works in the body
- Biochemical pathways and physiological effects
- Time course of effects (acute vs. chronic)

**📊 Evidence by Goal**
- Separate evidence grades for each fitness goal
- Explanation of why grades differ between goals
- Key findings from the research for each application

**⚖️ Dosing & Timing**
- Evidence-based dosing ranges
- Optimal timing relative to training
- Loading phases where applicable
- Form considerations (e.g., creatine monohydrate vs. HCl)

**⚠️ Safety Profile**
- Known contraindications and precautions
- Drug interactions and medical conditions
- Age and pregnancy considerations
- Common side effects from research

#### **Search & Discovery**
- **Text Search**: Find supplements by name or description
- **Goal Filtering**: See evidence grades specific to your objectives
- **Grade Filtering**: Show only A/B grade supplements, or include all grades
- **Alphabetical Sorting**: Easy browsing of the complete database

### Data Source: Level 1 Banking

The supplement database directly exposes our Level 1 banking data, providing transparency into our evidence evaluation:

**What You See:**
- **Evidence Grades**: The exact A/B/C/D grades our LLM research agent assigned
- **Paper Counts**: How many studies were analyzed for each supplement × goal combination
- **Supporting Publications**: Top 3 research papers supporting each evidence grade with full metadata
- **Goal Specificity**: Why creatine might be Grade A for strength but Grade C for endurance
- **Research Transparency**: Understanding what evidence supports (or doesn't support) each supplement

**What This Means:**
- **No Hidden Algorithms**: The same evidence grades used in personalized stacks
- **Independent Research**: Make informed decisions before using the Stack Planner
- **Verification**: Cross-reference our recommendations with your own research
- **Education**: Understand why certain supplements are recommended for specific goals

### Integration with Stack Planner

The supplement database and Stack Planner work together:

**Research First, Personalize Second:**
1. **Explore** supplements independently on `/supplements`
2. **Learn** about mechanisms, evidence, and safety considerations
3. **Decide** which supplements interest you based on evidence
4. **Personalize** using the Stack Planner for dosing, timing, and safety screening

**Informed Decision Making:**
- Users can research supplements independently before committing to a personalized stack
- Understanding the evidence helps users make better decisions about optional supplements
- Transparency builds trust in the personalized recommendations

### Technical Implementation

**Backend (`GET /supplements/evidence`):**
- Loads Level 1 banking files (`level1_evidence_bank.json`)
- Transforms banking data into user-friendly format
- Includes supplement metadata (mechanisms, descriptions, safety notes)
- Returns structured JSON for frontend consumption

**Frontend (`/supplements` page):**
- React-based interface with goal filtering
- Real-time search and filtering
- Responsive design for mobile and desktop
- Integration with Stack Planner for seamless user flow

**Data Flow:**
1. LLM research agent analyzes papers → Level 1 banking cache with supporting publications
2. API endpoint exposes banking data → Structured JSON with publication metadata
3. Frontend displays evidence grades + publications → User research and discovery
4. User insights inform → Stack Planner decisions with complete publication trail

---

## Why Trust EvidentFit?

### 1. Research-Driven, Not Profit-Driven

**Full Disclosure**: We may earn affiliate commissions when you purchase supplements through our links.

**How We Maintain Independence:**
- AI analyzes your profile and the research—commission rates never enter the algorithm
- Supplement companies cannot pay for inclusion or better rankings
- If research doesn't support a supplement, we won't recommend it—no matter how profitable
- We always mention generic options and multiple brands
- Clear labeling of all affiliate relationships

**Our Business Logic**: Your trust is worth more than short-term commissions. If we lose your trust by pushing ineffective supplements, we lose our business.

### 2. Technical Safeguards Against Bias
- AI cannot cite papers it hasn't retrieved from PubMed (no hallucinations)
- Dosing calculations are deterministic, not AI-generated (no math errors)
- Safety guardrails are rule-based, not subject to AI interpretation
- Evidence grades based on objective study characteristics

### 3. Audit Trail
Every recommendation can be traced back to:
- **Base Evidence Publications**: The specific research papers that support the general evidence grade
- **Profile-Specific Publications**: The research papers relevant to your demographic profile
- **User-Specific Publications**: The research papers relevant to your specific context and conditions
- The safety rules that were applied
- The dosing formulas used

You can verify our work at every step with complete publication transparency.

### 4. Conservative by Design
When in doubt, we err on the side of caution:
- Higher evidence standards (Grade A/B only for primary recommendations)
- Comprehensive interaction screening
- Clear warnings about limitations and uncertainties
- "Consult your doctor" for anything remotely medical

---

## Our Limitations

We're honest about what our system can and cannot do:

1. **Full-text coverage**: We obtain full-text for 85-90% of papers via PMC (~73%) and Unpaywall (~12-17% rescue); remaining 10-15% use abstracts only
2. **English-language focus**: Most research we access is published in English
3. **Not medical advice**: We provide evidence-based education, not personalized medical care
4. **Population variability**: Research shows average effects in study populations—individual results may vary
5. **Evolving evidence**: New research may change recommendations; we update monthly but can't catch everything in real-time

---

## How to Use EvidentFit

### 💬 Research Chat
Ask questions and get evidence-based answers with citations.

**Good for:**
- Understanding what research says about specific supplements
- Comparing options for your goals
- Checking for potential interactions
- Diving deep into specific studies

### 🎯 Stack Planner  
Get a complete, personalized supplement protocol.

**Good for:**
- Building a complete supplement routine
- Getting specific dosing for your weight and goals
- Safety screening against your medications and conditions
- Understanding which supplements to prioritize vs. skip

---

## Continuous Improvement

Our methodology evolves as:
- New research is published (monthly updates)
- User feedback identifies gaps or issues
- Better AI models become available
- We learn from real-world use

We're committed to staying current with the science and transparent about our methods.

---

## Interactive Features & User Experience

### Stack Planner Interface

Our Stack Planner provides an interactive, user-friendly interface for exploring and customizing supplement recommendations:

#### **Toggle Navigation System**
- **Three clear sections**: Recommended, Optional, and Not Recommended supplements
- **One section at a time**: Reduces cognitive load and improves focus
- **Live counts**: See how many supplements are in each category
- **Easy switching**: Toggle between sections to explore all options

#### **Interactive Checkbox System**
- **Custom stack building**: Check/uncheck any supplement from any tier
- **Smart initialization**: Recommended supplements are pre-selected
- **Live summary**: See your custom stack at the top with evidence grades
- **Quick removal**: Remove supplements directly from the summary
- **Full transparency**: Access all details (dosing, research, reasoning) for every supplement

#### **Evidence-Based Details**
- **Research-backed reasoning**: Every "why" explanation is generated from actual research papers
- **Evidence grades**: A/B/C/D grades based on study quality and consistency
- **Base Evidence Citations**: Direct links to PubMed studies supporting the general evidence grade
- **Profile-Specific Citations**: Direct links to PubMed studies relevant to your demographic profile
- **Personalized explanations**: Reasoning tailored to your demographics and goals
- **Complete Publication Trail**: Full transparency from base evidence through profile-specific research

### Supplement Database

For users who want to research independently, we provide a comprehensive supplement database that directly exposes our Level 1 banking data:

#### **Independent Research Interface** (`/supplements`)
- **Goal-specific evidence**: See exactly how our LLM research agent graded each supplement for your goals
- **Transparent paper counts**: Know how many studies were analyzed for each grade
- **Mechanism explanations**: Understand how each supplement works in the body
- **Safety profiles**: Complete contraindications and interaction information
- **Research verification**: Direct links to the studies that support each recommendation

*See Part 4 above for complete technical details on how the supplement database works and integrates with our banking system.*

### Mobile-First Design

All features are optimized for mobile devices with:
- **Responsive layouts**: Clean display on phones, tablets, and desktops
- **Touch-friendly controls**: Easy checkbox and button interactions
- **Readable typography**: Clear text at all screen sizes
- **Fast loading**: Optimized performance on slower connections

---

## Questions or Concerns?

We welcome feedback and scrutiny:
- Found an error? Let us know.
- Disagree with an interpretation? We'll explain our reasoning.
- Want to see specific studies? All citations link directly to PubMed.
- Concerned about our business model? We're happy to discuss how we maintain independence.

Contact: [contact@evidentfit.com]

---

## Disclaimer

**EvidentFit provides educational information based on published research. It is not medical advice.**

Always consult with a qualified healthcare provider before starting any supplement regimen, especially if you:
- Have a medical condition
- Take prescription medications  
- Are pregnant or breastfeeding
- Are under 18 years old
- Have a history of adverse reactions to supplements

Individual responses to supplements vary. Published research shows average effects in study populations—your results may differ.

---

*Committed to evidence-based fitness supplementation*

